\graphicspath{{figures/Design/IPController/}}

\chapter{Design of the rocket Controller}\label{sec:IPController}
The goal of the controller is to balance the rocket body in an upright position. 

As seen in the modeling of the rocket, the system presents poles and zeros in the origin of the pole-zero plot. The system is unstable and goes to infinity on the imaginary axis. To solve this problem a zero could be added at a higher frenquency to attract the poles.

				% Figure of original tf
\begin{figure}[htbp]
	\centering
	
		\includegraphics[width=\textwidth]{figures/Rocket/design/initial_transfer_function_vf}
		\caption{Root locus of the initial rocket angle transfer function.}
		\label{fig:Rinitialtf}
	
\end{figure}

However the real system is influenced by the servomotors. The transfer function of the servomotors adds a pole, resulting in an unstable system moving towards infinity on the imaginary axis. 
				
				% Figure of tf + servo
\begin{figure}[htbp]
	\centering
		\includegraphics[width=\textwidth]{figures/Rocket/design/tf_with_servo_vf}
		\caption{System with the servomotors.}
		\label{fig:SystemServo}
\end{figure}

To direct the root locus to a stable state, a controller C1, adding a zero and a pole on the left side, is implemented. The zero of the controller is chosen to be near the system in order to attract the poles. The pole of the controller is set at high frequency to not temper with the system. 

				% Figure of tf + servo + C1, and zoom of tf + servo + C1
\begin{figure}[htbp]
	\centering
	\begin{subfigure}{0.45\textwidth}
		\includegraphics[width=\textwidth]{figures/Rocket/design/tf_with_controller_1C_1_vf}
		\caption{Total view of the poles and zeros.}
		\label{fig:SystemC1}
	\end{subfigure}
	\begin{subfigure}{0.45\textwidth}
		\centering
		\includegraphics[width=\textwidth]{figures/Rocket/design/tf_with_C1_zoom_vf}
		\caption{Focus on low frequencies.}
		\label{fig:SystemC1zoom}
	\end{subfigure}
	\caption{Root locus of the system with C1 implemented.}
\end{figure}

Another controller C2 is needed to attract the two poles going to infinity along the imaginary axis. The pole and zeros of C2 are set at higher frequencies than the first controller C1. 

				% Figure of final tf with controllers 
\begin{figure}[htbp]
	\centering
	
		\includegraphics[width=\textwidth]{figures/Rocket/design/tf_with_controller_1_vf}
		\caption{Root locus of the rocket transfer function.}
		\label{fig:SystemC1C2}
		
\end{figure}

The rocket requires a fast settling time and rise time in order to act as soon as possible and control the rocket's stability. Lead compensaters enable the modulation of the rise time, but impact the overshoot. The overshoot is considered as an inferrior error, being in part countered by the play of the gimbal system. 

To improve the setling time, the gain is set at $2.15 * 10^3$ \si{\dB}. This value is chosen by observing the root locus and the gain of a set point as shown on \autoref{fig:SystemC1C2Zoom}.

				% Figure of chosen point, and of final tf with 2.15*10^3
\begin{figure}[htbp]
	\centering
	\begin{subfigure}{0.45\textwidth}
		\includegraphics[width=\textwidth]{figures/Rocket/design/tf_with_controller_1_zoom_vf}
		\caption{Set point at the start of the circle.}
		\label{fig:SystemC1C2Zoom}
	\end{subfigure}
	\begin{subfigure}{0.45\textwidth}
		\centering
		\includegraphics[width=\textwidth]{figures/Rocket/design/tf_with_controller_215_vf}
		\caption{Additional gain of $2.15*10^3$ \si{\dB}.}
		\label{fig:SystemGain215}
	\end{subfigure}
	\caption{Root locus of the rocket transfer function with additional gain of respectively $1$ and $2.15*10^3$ \si{\dB}.}
\end{figure}


The servomotors can have a faster rising time according to the step response of the servomotors, as shown in \autoref{tab:TableStepr}. The gain is then doubled to improve the rise time and setling time. The new adjusted transfer function is observed on \autoref{fig:FinalRocketTf} and \autoref{fig:FinalRocketTfZoom}.

\begin{table}[htbp]
	\centering
	\caption{Simulated step responses.}
	\label{tab:TableStepr}
	\begin{tabular}{llll}
		Transfer function & Rise time{(}s{)} & Setling time{(}s{)} & Overshoot{(}percentage{)} \\ \hline  \rowcolor{lightGrey}
		Servomotors     & 0.0589 & 0.0782 & 0\\  
		Gain of $2.15*10^3$     & 0.1669 & 1.2075 & 14.5609  \\  
		\rowcolor{lightGrey}           
		Gain of $5*10^3$     & 0.0854 & 0.7845 & 12.0162      \\     
	\end{tabular}
\end{table}

				% Figure of final tf with 5*10^3
\begin{figure}[htbp]
	\centering
	\begin{subfigure}{0.45\textwidth}
		\includegraphics[width=\textwidth]{figures/Rocket/design/tf_with_controller_5_vf}
		\caption{Root locus of the rocket transfer function with an additional gain of $5 * 10^3$ \si{\dB}.}
		\label{fig:FinalRocketTf}
	\end{subfigure}
	\begin{subfigure}{0.45\textwidth}
		\includegraphics[width=\textwidth]{figures/Rocket/design/tf_with_controller_5_zoom_vf}
		\caption{Focus on lower frequencies.}
		\label{fig:FinalRocketTfZoom}
	\end{subfigure}
	\caption{Root locus of the rocket transfer function with additional gain of $5*10^3$ \si{\dB}.}	
\end{figure}


The frequency correponds to a complete rotation of the servomotors. At low frequencies a delay is observed on \autoref{fig:BodeplotFinalTf}. However the system functions at low speed. This implies that the delay has a tempered effect on the system. Higher frequencies are not physicaly possible and do not need to be compensated.

				% Figure of final tf bodepoint
\begin{figure}[htbp]
	\centering
		\includegraphics[width=\textwidth]{figures/Rocket/design/bodeplot}
		\caption{Bodeplot of the rocket transfer function.}
		\label{fig:BodeplotFinalTf}
\end{figure}

The controlled rocket transfer function is shown on equation \autoref{eq:RocketTfEqu} and figure \autoref{fig:FinalChart}.

\begin{equation}    
R = 5 \cdot 10^3 \cdot \frac{s + 2}{s + 1000} \cdot \frac{s + 50}{s + 1100} \cdot \frac{1}{s \cdot \uptau + 1} \cdot \frac{F_t \cdot L_{Cg} \cdot \frac{1}{M_r \cdot L_{Es}^2}}{s^2}  
\end{equation}
\label{eq:RocketTfEqu}

\begin{figure}[htbp]
	\centering
	
	\includegraphics[width=\textwidth]{figures/Rocket/design/final_chart}
	\caption{Rocket transfer function.}
	\label{fig:FinalChart}
	
\end{figure}